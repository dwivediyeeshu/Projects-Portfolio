<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rate-Limited + Memoized API Fetcher</title>
  <style>
    body {
      background: #0f172a;
      color: #f8fafc;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding-top: 80px;
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s;
    }

    button:hover {
      background: #2563eb;
    }

    #status {
      margin-top: 30px;
      font-size: 18px;
      color: #a5f3fc;
    }
  </style>
</head>
<body>
  <h1>🚀 Rate-Limited + Memoized API Fetcher</h1>
  <p>Open your <strong>console</strong> to see the logs 👇</p>

  <div>
    <button onclick="handleFetch('yeeshu')">Fetch Yeeshu</button>
    <button onclick="handleFetch('john')">Fetch John</button>
    <button onclick="handleFetch('yeeshu')">Fetch Yeeshu Again</button>
  </div>

  <div id="status">Waiting for user action...</div>

  <script>
    // 🧠 Memoization: cache results
    function memoize(fn) {
      const cache = {};
      return async function(...args) {
        const key = JSON.stringify(args);
        if (cache[key]) {
          console.log('⚡ Returning cached result...');
          return cache[key];
        } else {
          console.log('🌐 Fetching fresh data...');
          const result = await fn(...args);
          cache[key] = result;
          return result;
        }
      };
    }

    // 🕒 Rate limiter: prevent frequent calls
    function rateLimit(fn, limit) {
      let lastCalled = 0;
      return async function(...args) {
        const now = Date.now();
        if (now - lastCalled < limit) {
          return '🚫 Rate limit exceeded. Try again later.';
        } else {
          lastCalled = now;
          return fn(...args);
        }
      };
    }

    // 🔹 Simulated API function
    async function fetchUserData(username) {
      await new Promise(res => setTimeout(res, 1000)); // mock delay
      return { user: username, followers: Math.floor(Math.random() * 1000) };
    }

    // ✅ Combine both features
    const safeFetchUserData = rateLimit(memoize(fetchUserData), 3000);

    // 🎮 UI handler
    async function handleFetch(username) {
      const status = document.getElementById('status');
      status.textContent = `Fetching data for "${username}"...`;

      const result = await safeFetchUserData(username);
      console.log('🔹 Result:', result);

      if (typeof result === 'string') {
        status.textContent = result;
      } else {
        status.textContent = `✅ ${result.user} has ${result.followers} followers`;
      }
    }
  </script>
</body>
</html>
